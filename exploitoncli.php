<?php
/*
 * ,------------------------------,
 * | Author: R00Tmars |
 * | Email: mdk2@protonmai.com |
 * | GitHub: github.com/r00tmars |
 * | Twitter: @sr_mdk |
 * '------------------------------'
 *
 * The best offline exploit database
 *
 * Código escrito com a bunda e com muito amor
 *
 */
$version = 'BETA';
$reintentos = 5;
$script_path = getcwd ();

require_once $script_path . '/functions/banners.php';
require_once $script_path . '/functions/others.php';
require_once $script_path . '/functions/update.php';

if (! file_exists ( "files" )) {
	mkdir ( "files" );
}
if (! file_exists ( "update" )) {
	mkdir ( "update" );
}

// # OPT
$long_opt = array (
		'search:',
		'update::',
		'about::',
		'help::',
		'down::' 
);
$opt = getopt ( 'h::s:a::d::', $long_opt );

// ###################################################################
// # VALHALLA
echo banner ( $version );
$down = FALSE;
if (isset ( $opt ["help"] ) or isset ( $opt ["h"] )) {
	echo help (); // HELP
}
if (isset ( $opt ["about"] ) or isset ( $opt ["a"] )) {
	echo about (); // ABOUT
}
if (isset ( $opt ["update"] )) {
	echo update ( $opt ); // UPDATE
}
if (isset ( $opt ["s"] )) {
	$opt ["search"] = $opt ["s"]; // FIND
}
if (isset ( $opt ["down"] ) or isset ( $opt ["d"] )) {
	$down = TRUE; // ABOUT
}

if (empty ( $opt ["search"] )) { // Se não tiver nada para pesquisar, DIE MOTHERFUCKER
	exit ();
}

// INFOS
echo "     SEARCH TERM: \033[00;31m{$opt["search"]}\n\033[0;37m            DB's: ALL\n    DOWN SOURCES: ";
if ($down == TRUE) {
	echo "\033[0;31mYES\033[0;37m\n";
} else {
	echo "NOT\n";
}

// PEGANDO OS DADOS DOS ARQUIVOS
$file = dados ();

// MAIS UMA PARTE DAS INFOS
echo " EXPLOITS LOADED: \033[0;31m" . number_format ( count ( $file ), 0, ",", "." ) . "\033[0;37m\n\n";

// GAMBIARRA PARA CABER NA TELA
$pnt = "";
$nm = 31;
if (strlen ( $script_path ) >= 30) {
	$pnt = "..";
	$nm = 29;
}

echo "\033[0;30m------------------------------------------------------------------------------------------------------------------------------------------------------------------------\033[0;37m
 TITLE                                                                                           \033[0;30m|\033[0;37m PATH ( " . @substr ( $script_path, 0, $nm ) . $pnt . " )" . @str_repeat ( " ", $nm - strlen ( $script_path ) ) . "\033[0;30m|\033[0;37m ID         \033[0;30m|\033[0;37m DATABASE
\033[0;30m------------------------------------------------------------------------------------------------------------------------------------------------------------------------\033[0;37m\n";

$id = 0;
foreach ( $file as $trash => $f ) { // FOREACH COM CADA LINHA DOS DBS
	preg_match_all ( '/"(.*?)","(.*?)","(.*?)","(.*?)","(.*?)","(.*?)"/i', $f, $dados );
	
	if (@preg_match ( "/" . strtolower ( $opt ["search"] ) . "/si", strtolower ( $dados [5] [0] ) )) { // Caso encontre..
		$pnt = "";
		$nm = 95;
		
		if (strlen ( $dados [5] [0] ) >= 92) { // Caso o titulo tenha mais que 92 caracteres..
			$pnt = "..";
			$nm = 93;
		}
		
		// Arrumando o TITULO
		$title = preg_replace ( "/{$opt["search"]}/si", "\033[0;31m" . strtoupper ( $opt ["search"] ) . "\033[0;37m", @substr ( $dados [5] [0], 0, $nm ) . $pnt . @str_repeat ( " ", $nm - strlen ( $dados [5] [0] ) ) );
		
		echo " " . $title . " \033[0;30m|\033[0;37m ";
		
		if ($down == TRUE) { // caso a opção de download for selecionado
			downcode ( $dados );
		}
		
		$path = "files" . DIRECTORY_SEPARATOR . $dados [1] [0] . DIRECTORY_SEPARATOR . strtolower ( $dados [2] [0] ) . DIRECTORY_SEPARATOR . $dados [4] [0] . ".txt";
		if (! file_exists ( $path )) { // Se o arquivo não existe, exibe o link
			if (preg_match ( "/exploit4arab/si", $dados [1] [0] )) {
				$path = "exploit4arab.org/" . strtolower ( $dados [2] [0] ) . "/" . $dados [4] [0];
			}
			if (preg_match ( "/packetstorm/si", $dados [1] [0] )) {
				$path = "packetstormsecurity.com/files/" . $dados [4] [0] . "/";
			}
			if (preg_match ( "/cxsecurity/si", $dados [1] [0] )) {
				$path = "cxsecurity.com/issue/WLB-" . $dados [4] [0];
			}
			if (preg_match ( "/exploit-db/si", $dados [1] [0] )) {
				$path = "exploit-db.com/exploits/" . $dados [4] [0] . "/";
			}
			if (preg_match ( "/iedb/si", $dados [1] [0] )) {
				$path = "iedb.ir/exploits-" . $dados [4] [0] . ".html";
			}
			if (preg_match ( "/siph0n/si", $dados [1] [0] )) {
				$path = "siph0n.in/exploits.php?id=" . $dados [4] [0];
			}
		}
		
		echo $path . @str_repeat ( " ", 39 - strlen ( $path ) ) . " \033[0;30m|\033[0;37m "; // PATH
		echo $dados [4] [0] . @str_repeat ( " ", 10 - strlen ( $dados [4] [0] ) ) . " \033[0;30m|\033[0;37m "; // ID
		echo strtoupper ( $dados [1] [0] ) . PHP_EOL; // DATABASE
		$id ++;
	}
}

echo "\033[0;30m------------------------------------------------------------------------------------------------------------------------------------------------------------------------\033[0;37m
 \033[0;31m{$id}\033[0;37m EXPLOITS FOUND
\033[0;30m------------------------------------------------------------------------------------------------------------------------------------------------------------------------\033[0;37m\n\n";
 
# END OF THE WORLD
